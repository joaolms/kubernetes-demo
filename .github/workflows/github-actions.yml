name: Kubernetes Demo on Azure
on:
  - push

jobs:
  testes:
    
    runs-on: ubuntu-latest
    
    steps:
    - name: Check out
      uses: actions/checkout@v2
  
    - name: Ansible lint
      uses: ansible/ansible-lint-action@master
      with:
        targets: "k8s-playbook.yml"
  
    - name: Terraform init
      run: terraform init --upgrade=true
    
    - name: Terraform validate
      run: terraform validate
    
    - name: Terraform plan
      run: terraform plan
      env:
        ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
        ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
        ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
        ARM_CLIENT_SECRET: ${{ secrets.ARM_SCLIENT_SECRET }}
        TF_VAR_SSH_PUBKEY: "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDUAxiGqjjr0GZyxgkd7/i0dRkP9Q7rkwEL+HmlvHHZ4HaYnjG/o3q8vIPY9hvYXqo9MGsKuw8sXrVqb1SeSnnUxDuv5qdSmUzWoBJfKMPP7769SOtJU5bQuuTKiFk/qdRkfba1Qpxia9h8YKHiLBGh3KGEiPk/OuacajNwh2KvfUBFb15U1CUAlklEEBFYDm9vqsxs3cGM2WzZpeDJwgy1gkx0USa4ELgMSvDS230qo6nTvuO2/SboYNkGS813HXd60EV2jY/xJDZ4KnW53y7XknVcuyFoF2GAPfYqYggF09KKR4FJIOlB1NSFJ8jrAKzmjRDeB+9mQsfuZP+aOh50VhUfP2jF7SMvBtWFEE6w1C7dOwQ9PnIJR1XBIDA4Sp6FyAhfopUyPJohmkbaz1IA6/RQ6PD0agGTqB7Aou8UzUsj2oxAIB4SBFUHJ/UKeB36/IDl4DWg24oR7i/QQ+9Iph1teZQWOkPgAisiEtzKXv7d0pgiCe5KkTfoh6PvGWU="
